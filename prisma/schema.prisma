generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                       String              @id @default(cuid())
  email                    String              @unique
  googleAccountId          String?             @unique
  googleAccessToken        String?
  googleRefreshToken       String?
  googleTokenExpiresAt     DateTime?
  youtubeCookies           String?
  youtubeCookiesCreatedAt  DateTime?
  youtubeCookiesLastUsedAt DateTime?
  createdAt                DateTime            @default(now())
  updatedAt                DateTime            @updatedAt
  videos                   Video[]
  tiktokConnections        TikTokConnection[]
}

model Video {
  id                          String   @id @default(cuid())
  userId                      String
  sourceUrl                   String
  title                       String
  durationSec                 Int
  status                      String
  createdAt                   DateTime @default(now())
  updatedAt                   DateTime @updatedAt
  transcript                  Json?
  retentionHotspotsJson       Json?
  commentTimestampHotspotsJson Json?
  globalCropMapJson           Json?
  clips                       Clip[]
  user                        User     @relation(fields: [userId], references: [id])
  @@index([userId])
}

model TikTokConnection {
  id           String   @id @default(cuid())
  userId       String
  openId       String   @unique
  accessToken  String
  refreshToken String
  expiresAt    DateTime
  scopes       String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id])
}

model Clip {
  id              String   @id @default(cuid())
  videoId         String
  startSec        Int
  endSec          Int
  durationSec     Int
  category        String
  tags            String[]
  scoreHook       Int
  scoreRetention  Int
  scoreClarity    Int
  scoreShare      Int
  scoreOverall    Int
  rationale       String
  rationaleShort  String?
  featuresJson    Json?
  durationChoice  String?
  s3VideoKey      String
  s3ThumbKey      String
  s3SrtKey        String
  smartFramed     Boolean  @default(false)
  cropMapJson     Json?
  createdAt       DateTime @default(now())
  tiktokPublishId String?
  tiktokStatus    String?
  tiktokTitle     String?
  tiktokDescription String?
  Video           Video    @relation(fields: [videoId], references: [id])
  @@index([videoId])
}
